<!DOCTYPE html>
<html dir="ltr" mozdisallowselectionprint moznomarginboxes>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="google" content="notranslate">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>PDF.js viewer</title>


    <link rel="stylesheet" href="viewer.css">



<!-- This snippet is used in production (included from viewer.html) -->
<link rel="resource" type="application/l10n" href="locale/locale.properties">

<script src="build/pdf.js"></script>
<script src="default_url.js"></script>
<script src="viewer.js"></script>
<script src="build/sigma.min.js"></script>
<script src="build/plugins/sigma.parsers.gexf.min.js"></script>
<script src="build/plugins/sigma.plugins.filter.min.js"></script>
<script src="build/jquery-3.3.1.min.js"></script>

<div id='sents2'></div>

<script>

var jd_sents;
var jd2_keys;
var jd2;
var jd;
var cooling = false;
var filtering = false;
var slider_value_copy = 0;
var firstWordPinning = false;
var clientX;
var this_s;
// var s;
var sentsIn_from_left = false;
var sentsIn_from_right = false;
var sents2In = false;
var sents2In_from_left = false;
var sents2In_from_right = false;
var sents2_filled = false;
var pdfIn = false;
var firstWordOccupying = false;
var formalSentsDisplaying = false;
var current_page = 1
var searchSwitcher = 192
var useExtendedTerms = 1
var useUnextendedTerms
var useExtUnextendedTerms
var current_ext_unext_terms
var current_extended_terms
var current_unextended_terms
var hasFitPageWidth = false;
var hasHideEdges = false;
var sidebarToggleClicked = false;
var tempSentsDisplaying = false;
var jd;
var kw_dict = {'A':'','B':''};
var filter;

console.log('loading json')
var xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        jd_sents = JSON.parse(this.responseText);
        console.log('jd_sents loaded')
    }
};
xmlhttp.open("GET", "sents_json.txt", true);
xmlhttp.send();

var xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        jd = JSON.parse(this.responseText);
        console.log('json loaded')
    }
};
xmlhttp.open("GET", "json.txt", true);
xmlhttp.send();

var xmlhttp2 = new XMLHttpRequest();
xmlhttp2.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        jd2 = JSON.parse(this.responseText);
        console.log('json2 loaded')
    }
};
xmlhttp2.open("GET", "json2.txt", true);
xmlhttp2.send();

console.log('I am just some separatorsssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss11')

 $(function(){

  document.onmousemove = function(){
    clientX = event.clientX;
    // console.log('clientX is:',clientX)
  }

  var sents_div = $('#sents')

function pdf_io(el){
  var oc = $('#outerContainer');
  el.click(function(){
  //console.log('click button');
  if(oc.hasClass('in')){
    oc.animate({left:'100%'}).removeClass('in');
    pdfIn = false;
  } else {
    oc.animate({left:'20%'}).addClass('in')
    pdfIn = true;
  }
  });
};

function sents_out(){
    var sents_div = $('#sents');
    if(sents_div.hasClass('in') && !sents_div.hasClass('from_right')){
      sents_div.stop().animate({left:'auto',right:'100%'},'fast').removeClass('in');
      // console.log('sents_out left')
      sentsIn_from_left = false;
    }else if(sents_div.hasClass('in') && sents_div.hasClass('from_right')){
      sents_div.stop().animate({right:'auto',left:'100%'},'fast').removeClass('in from_right');
      sentsIn_from_right = false;
    }
}

function sents_in(){
    console.log('from sents_in')
    var sents_div = $('#sents');
    sents_div_width = $(window).width()*0.25;
    // console.log('sents_div_width is:',sents_div_width)
    if(clientX > sents_div_width){
      // console.log('sents_in left')
      sents_div.css({
        left:'auto',
        right:'100%',
      })
      if(!sents_div.hasClass('in')){
      sents_div.stop().animate({right:'75%'},'fast').addClass('in');
      sentsIn_from_left = true;
      }
    }else{
      // console.log('should from right')
      sents_div.css({
        right:'auto',
        left:'100%',
      })
      if(!sents_div.hasClass('in')){
      sents_div.stop().animate({left:'75%'},'fast').addClass('in from_right');
      sentsIn_from_right = true;
      }
    }
    
}

function sents_io(){
    console.log('from sents_io')
    var sents_div = $('#sents');
    var sigma_div = $('#sigma_container');
    if(sents_div.hasClass('in')){
    sents_div.animate({right:'100%'}).removeClass('in');
    sentsIn = false;
    }else {
    sents_div.animate({right:'75%'}).addClass('in');
    sentsIn = true;
    }
}
//pdf_io($('#btn'));

$(document).keyup(function(e) {
    if (e.keyCode == searchSwitcher && pdfIn == false){
      console.log('from e.keyCode == searchSwitcher && pdfIn == false')
      sents_io('e.keyCode == searchSwitcher && pdfIn == false')
    }
    else if (e.keyCode == 27 && !sents2In == true) {
      var oc = $('#outerContainer');
      if(oc.hasClass('in')){
      oc.animate({left:'100%'}).removeClass('in');
      pdfIn = false;
      }else {
      oc.animate({left:'20%'}).addClass('in')
      pdfIn = true;
      }    
    }
    else if (e.keyCode == searchSwitcher && useExtendedTerms == 1 && current_ext_unext_terms != null){
      window.PDFViewerApplication.page = current_page
      $('#findInput')[0].value = current_ext_unext_terms;
      document.getElementById('findHighlightAll').checked=false
      document.getElementById('findHighlightAll').click()
      useExtendedTerms = 0
      useUnextendedTerms = 0
      useExtUnextendedTerms = 1
    }
    else if (e.keyCode == searchSwitcher && useExtUnextendedTerms == 1 && current_unextended_terms != null){
      window.PDFViewerApplication.page = current_page
      $('#findInput')[0].value = current_unextended_terms;
      document.getElementById('findHighlightAll').checked=false
      document.getElementById('findHighlightAll').click()
      useExtendedTerms = 0
      useUnxtendedTerms = 1
      useExtUnextendedTerms = 0
    }
    else if (e.keyCode == searchSwitcher && useUnxtendedTerms == 1 && current_extended_terms != null){
      window.PDFViewerApplication.page = current_page
      $('#findInput')[0].value = current_extended_terms;
      document.getElementById('findHighlightAll').checked=false
      document.getElementById('findHighlightAll').click()
      useExtendedTerms = 1
      useUnxtendedTerms = 0
      useExtUnextendedTerms = 0
    }
});

//222
function sents_display_worker(sents_list,div_id,word_a,word_b){
    // console.log('sents_list.length is:',sents_list.length)
    // sents_list = jd[word_a][word_b]
    // sents_list.length = 1;
    for (let i=0;i<sents_list.length;i++){

      var sent_idx = sents_list[i]['sent_idx'];
      var sent_div = $('<div class = "sents" id = ' + sent_idx + '></div>')
      // let sent_text = sents_list[i]['sent'];
      // console.log('sents_list[i] is:',sents_list[i]);   
      // console.log('sent_idx is:',sent_idx);
      let sent_text = jd_sents[sent_idx]['sent']
      // console.log('sent_text from jd_sents is : ',sent_text);
      // console.log('word a and b are: ',word_a_re,word_b);
      
      word_a_match = sents_list[i]['matches'][word_a]
      word_b_match = sents_list[i]['matches'][word_b]
      let word_a_ = word_a_match;
      let word_b_ = word_b_match;
      var word_a_re = new RegExp('(' + word_a_match + ')','gi');
      var word_b_re = new RegExp('(' + word_b_match + ')','gi');
      // console.log('word a re is : ',word_a_re);
      sent_text_sub = sent_text.replace(word_a_re,'<span class="sent_i">$1</span>')
      sent_text_sub = sent_text_sub.replace(word_b_re,'<span class="sent_j">$1</span>')
      if( sent_text == sent_text_sub){
        console.log('sent_text is :33: ',sent_text);
        console.log('word a and match are: ',word_a,word_a_match);
        console.log('word b and match are: ',word_b,word_b_match);
      }
      // console.log('sent_text is :3: ',sent_text);
      var sent_text_p = $('<p></p>').html(sent_text_sub)
      sent_text_p.click(function() {
        var a=kw_dict['A']
        var b=kw_dict['B']
      //console.log( "kw_dict['A'] is  ",a," kw_dict['B'] is  ",b)
        if(!Array.isArray(sents_list[i]['page'])){
        current_page = sents_list[i]['page']
        }else{
        current_page = sents_list[i]['page'][0]
        }
        // current_page = sents_list[i]['page'][0]
        // if(current_page <= 1){
        //   window.PDFViewerApplication.page = 2
        //   // document.getElementById('previous').click()
        // }else{
        //   window.PDFViewerApplication.page = current_page
        // }
        window.PDFViewerApplication.page = current_page
        current_extended_terms_ori = sents_list[i]['term_ext'];
        // console.log('current_extended_terms_ori is: ',current_extended_terms_ori)
        // "((\\W*\\w*|\\A|\\Z)"+'\\W*\\b'+re.escape(ii) + '\\w*(\\W*\\w*|\\A|\\Z))'
        word_a_re = new RegExp("((\\W*\\w*|^|$)"+'\\W*\\b'+word_a_ + '\\w*(\\W*\\w*|^|$))','gi');
        word_b_re = new RegExp("((\\W*\\w*|^|$)"+'\\W*\\b'+word_b_ + '\\w*(\\W*\\w*|^|$))','gi');
        sent_head_re = new RegExp("(^(\\W*\\w*|^|$)(\\W*\\w*|^|$)(\\W*\\w*|^|$))",'gi');
        sent_tail_re = new RegExp("((\\w*|^|$)(\\W*\\w*|^|$)(\\W*\\w*\\W*|^|$)$)",'gi');
        // console.log('word_a_re is: ',word_a_re)
        // console.log('word_b_re is: ',word_b_re)
        current_extended_terms_array = [];
        current_extended_terms_array = current_extended_terms_array.concat(sent_text.match(word_a_re));
        current_extended_terms_array = current_extended_terms_array.concat(sent_text.match(word_b_re));
        current_extended_terms_array = current_extended_terms_array.concat(sent_text.match(sent_head_re));
        current_extended_terms_array = current_extended_terms_array.concat(sent_text.match(sent_tail_re));
        // console.log('sent_text.match(sent_head_re)',sent_text.match(sent_head_re))
        // console.log('sent_text.match(sent_tail_re)',sent_text.match(sent_tail_re))
        // console.log('current_extended_terms_array is: ',current_extended_terms_array)
        current_extended_terms = '';
        for(const i of current_extended_terms_array){
          i_trim = i.trim();
          current_extended_terms += '  ' + i_trim.replace(/ /g,'_')
        }
        // console.log('current_extended_terms is: ',current_extended_terms)

        // console.log('[i] is:',i);

        current_unextended_terms_ori = sents_list[i]['term_unext'];
        // console.log('current_unextended_terms_ori is: ',current_unextended_terms_ori)
        current_unextended_terms = '';
        for(const i of [word_a_,word_b_]){
          i_trim = i.trim();
          current_unextended_terms += '  ' + i_trim.replace(/ /g,'_')
        }
        // console.log('current_unextended_terms is: ',current_unextended_terms)

        current_ext_unext_terms_ori = sents_list[i]['term_ext_unext'];
        // console.log('current_ext_unext_terms_ori is: ',current_ext_unext_terms_ori)
        current_ext_unext_terms = '';
        for(const i of current_extended_terms_array.concat([word_a_,word_b_])){
          i_trim = i.trim();
          current_ext_unext_terms += '  ' + i_trim.replace(/ /g,'_')
        }
        // console.log('current_ext_unext_terms is: ',current_ext_unext_terms)

      //console.log('sents_list[i] is:',current_extended_terms);
        $('#findInput')[0].value = current_extended_terms;
        document.getElementById('findHighlightAll').checked=false
        document.getElementById('findHighlightAll').click()

        if($('#sidebarToggle').hasClass('toggled')){
          document.getElementById('sidebarToggle').click()
        }
        // if (sidebarToggleClicked==false){
        //     document.getElementById('sidebarToggle').click()
        //     sidebarToggleClicked = true;        
        // }
        if (hasFitPageWidth==false){
            PDFViewerApplication.pdfViewer.currentScaleValue = "page-width";
            hasFitPageWidth==true;
        }
      //console.log( "Handler for Sent.click() called." );
        });
        pdf_io(sent_text_p)
        
      // let sent_text = sents_list[i]['sent'];
      sent_idx_ele = $('<span class="sent_idx">&nbsp&nbsp&nbsp#&nbsp'+sent_idx + '</span>')
      sent_text_p.append(sent_idx_ele)
      sent_div.append(sent_text_p)
      
      
      // sent_div.append($('<p>=== I am the end of a sentence ===</></br>'));

      let sent_page_list = sents_list[i]['page']
      if(!Array.isArray(sent_page_list)){
        // console.log(sent_page_list,' is NOT array')
        sent_page_list = [sent_page_list]
      }
      for (let j=0;j<sent_page_list.length;j++){
        var sent_page_div = $('<p class="pageNum"></p>').text("<"+ sent_page_list[j]+">")
        sent_page_div.attr('id',sent_page_list[j]);
        sent_page_div.click(function() {
          var a=kw_dict['A']
          var b=kw_dict['B']
          current_page = sent_page_list[j]
          // if(current_page <= 1){
          //   window.PDFViewerApplication.page = 2
          //   // document.getElementById('previous').click()
          // }else{
          //   window.PDFViewerApplication.page = current_page
          // }          
          window.PDFViewerApplication.page = current_page
          current_extended_terms = sents_list[i]['term_ext'];
          current_unextended_terms = sents_list[i]['term_unext'];
          current_ext_unext_terms = sents_list[i]['term_ext_unext'];
          $('#findInput')[0].value = current_extended_terms;
          document.getElementById('findHighlightAll').checked=false
          document.getElementById('findHighlightAll').click()

          if($('#sidebarToggle').hasClass('toggled')){
            document.getElementById('sidebarToggle').click()
          }
          // if (sidebarToggleClicked==false){
          //   document.getElementById('sidebarToggle').click()
          //   sidebarToggleClicked = true;        
          // }
          if (hasFitPageWidth==false){
            PDFViewerApplication.pdfViewer.currentScaleValue = "page-width";
            hasFitPageWidth==true;
          }
        });
        pdf_io(sent_page_div)
        sent_div.append(sent_page_div);
      }
        
    $(div_id).append(sent_div);
    $(div_id).append($('<p></>'));
    }
}

function search(k1,k2,pgn){
        $('#findInput').value = k1 + ' ' + k2;
        document.getElementById('findHighlightAll').click()
        window.PDFViewerApplication.page=pgn
      };

function sents_display_worker_for_word_a(s_id_dict,div_id){
    // console.log('sents_list.length is:',sents_list.length)
    // sents_list = jd[word_a][word_b]
    // sents_list.length = 1;
    // s_id_dict[sent_idx] = {"word_a_match": [word_a_match],"word_b_match": [word_b_match],"page": [sent_page]}

    for (let i in s_id_dict){

      // let sent_text = sents_list[i]['sent'];
      var sent_idx = i;
      var sent_div = $('<div class = "sents" id = ' + sent_idx + '></div>')
      // console.log('sents_list[i] is:',sents_list[i]);   
      // console.log('sent_idx is:',sent_idx);
      let sent_text = jd_sents[i]['sent']
      // console.log('sent_text from jd_sents is : ',sent_text);
      // console.log('word a and b are: ',word_a_re,word_b);
      
      word_a_match = s_id_dict[i]['word_a_match'][0]
      word_b_match = s_id_dict[i]['word_b_match']
      let word_a_ = word_a_match;
      let word_b_ = '';
      var word_a_re = new RegExp('(' + word_a_match + ')','gi');
      // var word_b_re = new RegExp('(' + word_b_match + ')','gi');
      // console.log('word a re is : ',word_a_re);
      sent_text_sub = sent_text.replace(word_a_re,'<span class="sent_i">$1</span>')
      // sent_text_sub = sent_text_sub.replace(word_b_re,'<span class="sent_j">$1</span>')
      for (b of word_b_match){
        console.log('b is',b)
        var word_b_re = new RegExp('(' + b + ')','gi');
        sent_text_sub = sent_text_sub.replace(word_b_re,'<span class="sent_j">$1</span>')
      }
      // console.log('word_b_match is',word_b_match)
      // console.log(sent_text_sub)
      // if( sent_text == sent_text_sub){
      //   console.log('sent_text is :33: ',sent_text);
      //   console.log('word a and match are: ',word_a,word_a_match);
      //   console.log('word b and match are: ',word_b,word_b_match);
      // }
      // console.log('sent_text is :3: ',sent_text);
      var sent_text_p = $('<p></p>').html(sent_text_sub)
      sent_text_p.click(function() {
        var a=kw_dict['A']
        var b=kw_dict['B']
      //console.log( "kw_dict['A'] is  ",a," kw_dict['B'] is  ",b)
        if(!Array.isArray(s_id_dict[i]['page'])){
        current_page = s_id_dict[i]['page']
        }else{
        current_page = s_id_dict[i]['page'][0][0]
        }
        // current_page = sents_list[i]['page'][0]
        // if(current_page <= 1){
        //   window.PDFViewerApplication.page = 2
        //   // document.getElementById('previous').click()
        // }else{
        //   window.PDFViewerApplication.page = current_page
        // }
        window.PDFViewerApplication.page = current_page
        // console.log('going to',current_page,'from',s_id_dict[i]['page'][0])
        // current_extended_terms_ori = sents_list[i]['term_ext'];
        // console.log('current_extended_terms_ori is: ',current_extended_terms_ori)
        // "((\\W*\\w*|\\A|\\Z)"+'\\W*\\b'+re.escape(ii) + '\\w*(\\W*\\w*|\\A|\\Z))'
        word_a_re = new RegExp("((\\W*\\w*|^|$)"+'\\W*\\b'+word_a_ + '\\w*(\\W*\\w*|^|$))','gi');
        // word_b_re = new RegExp("((\\W*\\w*|^|$)"+'\\W*\\b'+word_b_ + '\\w*(\\W*\\w*|^|$))','gi');
        sent_head_re = new RegExp("(^(\\W*\\w*|^|$)(\\W*\\w*|^|$)(\\W*\\w*|^|$))",'gi');
        sent_tail_re = new RegExp("((\\w*|^|$)(\\W*\\w*|^|$)(\\W*\\w*\\W*|^|$)$)",'gi');
        // console.log('word_a_re is: ',word_a_re)
        // console.log('word_b_re is: ',word_b_re)
        current_extended_terms_array = [];
        current_extended_terms_array = current_extended_terms_array.concat(sent_text.match(word_a_re));
        // current_extended_terms_array = current_extended_terms_array.concat(sent_text.match(word_b_re));
        current_extended_terms_array = current_extended_terms_array.concat(sent_text.match(sent_head_re));
        current_extended_terms_array = current_extended_terms_array.concat(sent_text.match(sent_tail_re));
        // console.log('sent_text.match(sent_head_re)',sent_text.match(sent_head_re))
        // console.log('sent_text.match(sent_tail_re)',sent_text.match(sent_tail_re))
        // console.log('current_extended_terms_array is: ',current_extended_terms_array)
        current_extended_terms = '';
        for(const i of current_extended_terms_array){
          i_trim = i.trim();
          current_extended_terms += '  ' + i_trim.replace(/ /g,'_')
        }
        // console.log('current_extended_terms is: ',current_extended_terms)

        // console.log('[i] is:',i);

        // current_unextended_terms_ori = sents_list[i]['term_unext'];
        // console.log('current_unextended_terms_ori is: ',current_unextended_terms_ori)
        current_unextended_terms = '';
        for(const i of [word_a_,word_b_]){
          i_trim = i.trim();
          current_unextended_terms += '  ' + i_trim.replace(/ /g,'_')
        }
        // console.log('current_unextended_terms is: ',current_unextended_terms)

        // current_ext_unext_terms_ori = sents_list[i]['term_ext_unext'];
        // console.log('current_ext_unext_terms_ori is: ',current_ext_unext_terms_ori)
        current_ext_unext_terms = '';
        for(const i of current_extended_terms_array.concat([word_a_,word_b_])){
          i_trim = i.trim();
          current_ext_unext_terms += '  ' + i_trim.replace(/ /g,'_')
        }
        // console.log('current_ext_unext_terms is: ',current_ext_unext_terms)

      //console.log('sents_list[i] is:',current_extended_terms);
        $('#findInput')[0].value = current_extended_terms;
        document.getElementById('findHighlightAll').checked=false
        document.getElementById('findHighlightAll').click()

        if($('#sidebarToggle').hasClass('toggled')){
            document.getElementById('sidebarToggle').click()
          }
          
        // if (sidebarToggleClicked==false){
        //     document.getElementById('sidebarToggle').click()
        //     sidebarToggleClicked = true;        
        // }
        if (hasFitPageWidth==false){
            PDFViewerApplication.pdfViewer.currentScaleValue = "page-width";
            hasFitPageWidth==true;
        }
      //console.log( "Handler for Sent.click() called." );
        });
        pdf_io(sent_text_p)

      sent_idx_ele = $('<span class="sent_idx">&nbsp&nbsp&nbsp#&nbsp'+sent_idx + '</span>')
      sent_text_p.append(sent_idx_ele)
      sent_div.append(sent_text_p)
      // sent_div.append($('<p>=== I am the end of a sentence ===</></br>'));

      let sent_page_list = s_id_dict[i]['page'][0]
      if(!Array.isArray(sent_page_list)){
        // console.log(sent_page_list,' is NOT array')
        sent_page_list = [sent_page_list]
      }
      for (let j=0;j<sent_page_list.length;j++){
        var sent_page_div = $('<p class="pageNum"></p>').text("<"+ sent_page_list[j]+">")
        sent_page_div.attr('id',sent_page_list[j]);
        // sent_page_div.click(function() {
        //   var a=kw_dict['A']
        //   var b=kw_dict['B']
        //   current_page = sent_page_list[j]
        //   window.PDFViewerApplication.page = current_page
        //   current_extended_terms = sents_list[i]['term_ext'];
        //   current_unextended_terms = sents_list[i]['term_unext'];
        //   current_ext_unext_terms = sents_list[i]['term_ext_unext'];
        //   $('#findInput')[0].value = current_extended_terms;
        //   document.getElementById('findHighlightAll').checked=false
        //   document.getElementById('findHighlightAll').click()
        //   if (sidebarToggleClicked==false){
        //     document.getElementById('sidebarToggle').click()
        //     sidebarToggleClicked = true;        
        //   }
        //   if (hasFitPageWidth==false){
        //     PDFViewerApplication.pdfViewer.currentScaleValue = "page-width";
        //     hasFitPageWidth==true;
        //   }
        // });
        pdf_io(sent_page_div)
        sent_div.append(sent_page_div);
      }
        
    $(div_id).append(sent_div);
    $(div_id).append($('<p></>'));
    }
}

function display_sents_word_a(word_a){
    $('#sents').empty();
    console.log('jd[word_a].length of ',word_a,'issss',jd[word_a].length,'as',jd[word_a])
    // counter_tmp = 0;
    // if(jd[word_a].length){
    //   console.log('jd[word_a].length of ',word_a,'is',jd[word_a].length,'as',jd[word_a])
    //   jd_word_a_length_length = jd[word_a].length.length
    // }else{
    //   jd_word_a_length_length = 10000
    // }
    // for (var key in jd[word_a]) {
    //   if(counter_tmp <= jd_word_a_length_length){
    //     sents_display_worker(jd[word_a][key],'#sents',word_a,key)
    //     counter_tmp ++;
    //   }
      
    // }

    var word_a_match = []
    var s_id_dict = Array()
    for (var key in jd[word_a]) {
      for (let i=0;i<jd[word_a][key].length;i++){
        var sent_idx = jd[word_a][key][i]['sent_idx'];
        var sent_page = jd[word_a][key][i]['page'];
        var word_a_match = jd[word_a][key][i]['matches'][word_a]
        var word_b_match = jd[word_a][key][i]['matches'][key];
        if(!(sent_idx in s_id_dict)){
          s_id_dict[sent_idx] = {"word_a_match": [word_a_match],"word_b_match": [word_b_match],"page": [sent_page]}
        }else{
          s_id_dict[sent_idx]["word_a_match"].push(word_a_match)
          s_id_dict[sent_idx]["word_b_match"].push(word_b_match)
          s_id_dict[sent_idx]["page"].push(sent_page)
        }

        // word_a_match.push(jd[word_a][key][i]['matches'][word_a])
      }
    }  

    console.log(s_id_dict)

    sents_display_worker_for_word_a(s_id_dict,'#sents')
    // }
    $('.sents').sort(function(a,b){
      var a_idx = $(a).attr('id');
      var b_idx = $(b).attr('id');
      // var a_idx = $(a).children('p.pageNum').attr('id');
      // var b_idx = $(b).children('p.pageNum').attr('id');
      if(Number(a_idx) < Number(b_idx)){
        return -1;
      }else{
        return 1;
      }
    }).appendTo('#sents');
}

function display_sents(word_a,word_b){
    if(!(word_b in jd[word_a])){
      return
    }
    $('#sents').empty();
    sents_display_worker(jd[word_a][word_b],'#sents',word_a,word_b)
    
    $('.sents').sort(function(a,b){
      var a_idx = $(a).attr('id');
      var b_idx = $(b).attr('id');
      // var a_idx = $(a).children('p.pageNum').attr('id');
      // var b_idx = $(b).children('p.pageNum').attr('id');
      if(Number(a_idx) < Number(b_idx)){
        return -1;
      }else{
        return 1;
      }
    }).appendTo('#sents');
}

function word_pair_dict_loader(w){            //1

  if(kw_dict['A'].length == 0 && kw_dict['B'].length ==0){
    kw_dict['A'] = w;
    firstWordOccupying = true;
    formalSentsDisplaying = false;
    
  }else if(kw_dict['A'].length>0 && kw_dict['B'].length ==0){

    if( kw_dict['A'] == w){
      return
    }
    kw_dict['B'] = w; 
    word_a = kw_dict['A']
    word_b = kw_dict['B']
    display_sents(word_a,word_b)
    kw_dict['A'] = ''
    kw_dict['B'] = ''
    firstWordOccupying = false;
    formalSentsDisplaying = true;    

  }
};//1

function TempSentsViewOnHoverSecWord(w){

    if(kw_dict['A'].length>0 && kw_dict['B'].length ==0){
        word_a = kw_dict['A'];
        word_b = w;
        
        if(word_a!=word_b){
            display_sents(word_a,word_b);
            // tempSentsDisplaying = true;        
        }
    }   
}

console.log('I am just some separatorsssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss11')

function sents2_out(){
    var sents_div = $('#sents2');
    if(sents_div.hasClass('in') && !sents_div.hasClass('from_right')){
      sents_div.stop().animate({left:'auto',right:'100%'},'fast').removeClass('in');
      // console.log('sents_out left')
      sents2In_from_left = false;
      sents2In = false;
      sents2_filled = false;
    }else if(sents_div.hasClass('in') && sents_div.hasClass('from_right')){
      sents_div.stop().animate({right:'auto',left:'100%'},'fast').removeClass('in from_right');
      sents2In_from_right = false;
      sents2In = false;
      sents2_filled = false;
    }
}

function sents2_in(){
    console.log('from sents2_in')
    var sents_div = $('#sents2');
    sents_div_width = $(window).width()*0.25;
    // console.log('sents_div_width is:',sents_div_width)
    if(sentsIn_from_right == true){
      // console.log('sents_in left')
      if(!sents_div.hasClass('in')){
      sents_div.css({
        left:'auto',
        right:'100%',
      })
      sents_div.stop().animate({right:'75%'},'fast').addClass('in');
      sents2In_from_left = true;
      sents2In = true;
      }
    }else{
      // console.log('should from right')
      if(!sents_div.hasClass('in')){
      sents_div.css({
        right:'auto',
        left:'100%',
      })
      sents_div.stop().animate({left:'75%'},'fast').addClass('in from_right');
      sents2In_from_right = true;
      sents2In = true;
      }
    }
    
}

$(function(){
  console.log('from $()');

  $('#outerContainer').mouseup(function(){
  sents2_filled = false;
  word_selection = window.getSelection().toString()
  if(!word_selection){
    return;
  }
  console.log('word_selection is:>',word_selection,'<',word_selection.length);
  word_selection = word_selection.replace(/^\s+|\s+$/g,'');
  console.log('word_selection replaced is:>',word_selection,'<',word_selection.length);
  word_selection = $.trim(word_selection)
  console.log('word_selection trimmed is:>',word_selection,'<',word_selection.length);

  $('#sents2').empty();
  // $('#sents2').html('<div>' + word_selection + '</div>')

  for (var key in jd2) {
      if (jd2.hasOwnProperty(key)) { // this will check if key is owned by data object and not by 
        if(word_selection == key.split('__')[0]){
          console.log(key,jd2[key],'444new array')
          sents_display_worker(new Array(jd2[key]),'#sents2')
          $('#sents2 .sents').sort(function(a,b){
          var a_page = $(a).children('p.pageNum').attr('id');
          var b_page = $(b).children('p.pageNum').attr('id');
          if(Number(a_page) < Number(b_page)){
            return -1;
          }else{
            return 1;
          }
          }).appendTo('#sents2');
          sents2_filled = true;
        }
      }
  }
  if(sents2_filled == true){
    sents2_in();
  }else if(sents2_filled == false && sents2In == true){
    sents2_out();
  }
  })

})

$(document).keyup(function(e){
  if(e.keyCode == 27 && sents2In == true){
    sents2_out();
  }
})

console.log('I am just some separatorsssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss')

var _ = {
  $: function (id) {
    return document.getElementById(id);
  },

  all: function (selectors) {
    return document.querySelectorAll(selectors);
  },

  removeClass: function(selectors, cssClass) {
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      // Bootstrap compatibility
      el.className = el.className.replace(cssClass, '');
    }
  },

  addClass: function (selectors, cssClass) {
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      // Bootstrap compatibility
      if (-1 == el.className.indexOf(cssClass)) {
        el.className += ' ' + cssClass;
      }
    }
  },

  show: function (selectors) {
    this.removeClass(selectors, 'hidden');
  },

  hide: function (selectors) {
    this.addClass(selectors, 'hidden');
  },

  toggle: function (selectors, cssClass) {
    var cssClass = cssClass || "hidden";
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      if (-1 !== el.className.indexOf(cssClass)) {
        el.className = el.className.replace(cssClass, '');
      } else {
        el.className += ' ' + cssClass;
      }
    }
  }
};

function updatePane (graph, filter) {
  var maxDegree = 0,
      categories = {};
  
  graph.nodes().forEach(function(n) {
    maxDegree = Math.max(maxDegree, graph.weighted_degree(n.id));
    categories[n.attributes.acategory] = true;
  })

  // min degree
  _.$('min-degree').max = maxDegree;
  _.$('max-degree-value').textContent = maxDegree;
  
  // node category
  // var nodecategoryElt = _.$('node-category');
  // Object.keys(categories).forEach(function(c) {
  //   var optionElt = document.createElement("option");
  //   optionElt.text = c;
  //   nodecategoryElt.add(optionElt);
  // });

  // reset button
  _.$('reset-btn').addEventListener("click", function(e) {
    _.$('min-degree').value = 0;
    _.$('min-degree-val').textContent = '0';
    // _.$('node-category').selectedIndex = 0;
    filter.undo().apply();
    _.$('dump').textContent = '';
    _.hide('#dump');
  });

  // export button
  // _.$('export-btn').addEventListener("click", function(e) {
  //   var chain = filter.export();
  //   console.log(chain);
  //   _.$('dump').textContent = JSON.stringify(chain);
  //   _.show('#dump');
  // });
}

function do_filter(){
  // var v = e.target.value;
      _.$('min-degree').value = slider_value_copy;
      _.$('min-degree-val').textContent = slider_value_copy;

      filter
        .undo('min-degree')
        .nodesBy(function(n) {
          return this.weighted_degree(n.id) >= slider_value_copy;
        }, 'min-degree')
        .apply();
      cooling = true;
      setTimeout(function(){
        cooling = false;
      },1);
}

$(document).keydown(function(e){
  if(e.keyCode == 39 || e.keyCode == 69){
    if(cooling == false){
      slider_value_copy++;
      do_filter()
    }    
  }
  else if(e.keyCode == 37 || e.keyCode == 81){
    if(cooling == false && slider_value_copy > 0){
      slider_value_copy--
      do_filter()
    }  
  }
  else if(e.keyCode == 87){
    if(cooling == false){
      slider_value_copy = slider_value_copy + 3;
      do_filter()
    }    
  }
  else if(e.keyCode == 83){
    if(cooling == false && slider_value_copy > 0){
      slider_value_copy = slider_value_copy - 3;
      do_filter()
    }  
  }
  else if(e.keyCode == 68){
    if(cooling == false){
      slider_value_copy = slider_value_copy + 10;
      do_filter()
    }    
  }
  else if(e.keyCode == 65){
    if(cooling == false && slider_value_copy > 0){
      slider_value_copy = slider_value_copy - 10;
      do_filter()
    }  
  }
  else if(e.keyCode == 38){
    slider_value_copy = 0;
    _.$('min-degree').value = 0;
    _.$('min-degree-val').textContent = '0';
    // _.$('node-category').selectedIndex = 0;
    filter.undo().apply();
    _.$('dump').textContent = '';
    _.hide('#dump');
  }
})

console.log('I am just some separatorsssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss')

sigma.classes.graph.addMethod('neighbors', function(nodeId) {
  var k,
      neighbors = {},
      index = this.allNeighborsIndex[nodeId] || {};

  for (k in index)
    neighbors[k] = this.nodesIndex[k];

  return neighbors;
});

sigma.classes.graph.addMethod('weighted_degree', function(nodeId) {

    var k,
    neighbors = {},
    index = this.allNeighborsIndex[nodeId] || {};

    for (k in index)
      neighbors[k] = this.nodesIndex[k];

    var weighted_degree_sum = 0;
    this.edges().forEach(function(e){
      if ( nodeId == e.source && neighbors[e.target]){
        weighted_degree_sum += e.weight;           
      }});
    
    return weighted_degree_sum;
  });



sigma.parsers.gexf(
    'gexf.gexf',
    {
      container: 'sigma_container',
      settings:{
        scalingMode:"outside",
        minEdgeSize:0.025,
        maxEdgeSize:1,
      }
    },

function(s) {

      // Initialize the Filter API
      filter = new sigma.plugins.filter(s);

      updatePane(s.graph, filter);

      function applyMinDegreeFilter(e) {
        var v = e.target.value;
        _.$('min-degree-val').textContent = v;
        slider_value_copy = v;

        filter
          .undo('min-degree')
          .nodesBy(function(n) {
            return this.weighted_degree(n.id) >= v;
          }, 'min-degree')
          .apply();
      }

      // function applyCategoryFilter(e) {
      //   var c = e.target[e.target.selectedIndex].value;
      //   filter
      //     .undo('node-category')
      //     .nodesBy(function(n) {
      //       return !c.length || n.attributes.acategory === c;
      //     }, 'node-category')
      //     .apply();
      // }

      _.$('min-degree').addEventListener("input", applyMinDegreeFilter);  // for Chrome and FF
      _.$('min-degree').addEventListener("change", applyMinDegreeFilter); // for IE10+, that sucks
      // _.$('node-category').addEventListener("change", applyCategoryFilter);



      this_s = s;
      s.graph.nodes().forEach(function(n) {
        n.originalColor = n.color;
      n.originalLabel = n.label;
      n.display = 'show';
      });
      s.graph.edges().forEach(function(e) {
        e.originalColor = e.color;
      });


      s.bind('overNode', function(e) {

        if(Object.keys(e.data.captor).length === 0){
          return
        }

        var nodeId = e.data.node.id;

        var weighted_degree = s.graph.weighted_degree(nodeId)
        console.log('weighted_degree of ',nodeId,' is ',weighted_degree)

        if(e.data.node.display == 'hide'){
          return
        }

        if(firstWordOccupying == false && formalSentsDisplaying == false/**/){
          sents_in()
          display_sents_word_a(nodeId)
        }
        if(firstWordOccupying == true && formalSentsDisplaying == false){        
          if(kw_dict['A']!=nodeId){
              sents_in()
              display_sents(kw_dict['A'],nodeId);
            }
          }

        console.log('firstWordPinning is:',firstWordPinning)
        if(firstWordPinning == false){
          var toKeep = s.graph.neighbors(nodeId);
          toKeep[nodeId] = e.data.node;       

          s.graph.nodes().forEach(function(n) {
            if (toKeep[n.id]){
              n.color = n.originalColor;
            }else{
              n.color = '#eee';
              n.label = '';
              n.display = 'hide';}
          });

          s.graph.edges().forEach(function(e){
            if (toKeep[e.source] && toKeep[e.target]){
              e.color = e.originalColor;
            }
            else
              e.color = '#eee'
          });
          node = e.data.node,
          node.size = (node.size + 0.5)
          s.refresh();
          console.log('refreshed')
          node.size = (node.size - 0.5)
        }


        // word_pair_dict_loader(nodeId);
        
        console.log('overNode over')
        });

      
      s.bind('rightClickNode',function(e){
        var nodeId = e.data.node.id;
        word_pair_dict_loader(nodeId);
        if(firstWordOccupying == true){
          e.data.node.label = '@' + e.data.node.label;
          firstWordPinning = true;
          s.refresh();
          display_sents_word_a(nodeId)        
        }
        /*tempSentsDisplaying = false;*/
        formalSentsDisplaying = true;
      })

      s.bind('clickNode', function(e) {
        var nodeId = e.data.node.id;
        // console.log('out of if@ of nodeId:',nodeId)
        if(firstWordOccupying == false /*&& formalSentsDisplaying == false*/){
          // console.log('inside of if@ of nodeId:',nodeId)
          e.data.node.label = '@' + e.data.node.label;
          firstWordPinning = true;
          s.refresh();          
        }
        word_pair_dict_loader(nodeId);
        });
      
      s.bind('outNode',function(){        
        if ( formalSentsDisplaying==false /*tempSentsDisplaying==true &&*/){
            $('#sents').empty();
            sents_out()    
            /*tempSentsDisplaying = false;*/
        }
      });


      document.oncontextmenu = function() {return false;};
        s.bind('rightClickStage', function(e) {
    
        {
          s.graph.nodes().forEach(function(n) {
          n.label = n.originalLabel
          n.color = n.originalColor;
          });

          s.graph.edges().forEach(function(e) {
            e.label = e.originalLabel
            e.color = e.originalColor;
            });

          firstWordOccupying = false
          kw_dict['A'] = ''
          hasHideEdges = false;
          $('#sents').empty();
          sents_out();
          formalSentsDisplaying = false;
        };
        // Same as in the previous event:
        s.refresh();
      });



      //移开复色
      s.bind('outNode',function(){
        if(firstWordOccupying == true /*&& formalSentsDisplaying == false*/){
          return
        }
        // console.log('frome outNode func')
        s.graph.nodes().forEach(function(n){
          n.color = n.originalColor;
          n.label = n.originalLabel;
          n.display = 'show';
        })

        s.graph.edges().forEach(function(e){
          e.color = e.originalColor;
        });
        firstWordPinning = false;
        s.refresh();
        
      });

    }
);
});

console.log('I am just some separatorsssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss')

</script>


</head>

<body tabindex="1" class="loadingInProgress">

<div id="corner">Corner z2 31</div>
<div id='sents'></div>
<div id='sigma_container'></div>

<div id="control-pane">
    <div>
      <p id = 'filter_head'>Min Degree <b></b><span id="min-degree-val">0</span></p>
      0 <input id="min-degree" type="range" min="0" max="0" value="0"> <span id="max-degree-value">0</span><br>
    </div>

    <div>
      <button id="reset-btn">Reset filters</button>
    </div>
    <div id="dump" class="hidden"></div>
  </div>
</div>

<!--
      <h3>min degree <span id="min-degree-val">0</span></h3>
    <button id="export-btn">Export</button>
    <div>
      <h3>node category</h3>
      <select id="node-category">
        <option value="" selected>All categories</option>
      </select>
    </div>
    <span class="line"></span>

<h2 class="underline">filters</h2>
<button id='btn'>PDF_IO</button>
<button id='btn' onmouseover="console.log('hi')"> PDF IO </button>
<div id="container">
  <div id="graph-container"></div>
</div>
-->







    <div id="outerContainer">
      <div id="sidebarContainer">
        <div id="toolbarSidebar">
          <div class="splitToolbarButton toggled">
            <button id="viewThumbnail" class="toolbarButton toggled" title="Show Thumbnails" tabindex="2" data-l10n-id="thumbs">
               <span data-l10n-id="thumbs_label">Thumbnails</span>
            </button>
            <button id="viewOutline" class="toolbarButton" title="Show Document Outline (double-click to expand/collapse all items)" tabindex="3" data-l10n-id="document_outline">
               <span data-l10n-id="document_outline_label">Document Outline</span>
            </button>
            <button id="viewAttachments" class="toolbarButton" title="Show Attachments" tabindex="4" data-l10n-id="attachments">
               <span data-l10n-id="attachments_label">Attachments</span>
            </button>
          </div>
        </div>
        <div id="sidebarContent">
          <div id="thumbnailView">
          </div>
          <div id="outlineView" class="hidden">
          </div>
          <div id="attachmentsView" class="hidden">
          </div>
        </div>
      </div>  <!-- sidebarContainer -->

      <div id="mainContainer">
        <div class="findbar hidden doorHanger" id="findbar">
          <div id="findbarInputContainer">
            <input id="findInput" class="toolbarField" title="Find" placeholder="Find in document…" tabindex="91" data-l10n-id="find_input">
            <div class="splitToolbarButton">
              <button id="findPrevious" class="toolbarButton findPrevious" title="Find the previous occurrence of the phrase" tabindex="92" data-l10n-id="find_previous">
                <span data-l10n-id="find_previous_label">Previous</span>
              </button>
              <div class="splitToolbarButtonSeparator"></div>
              <button id="findNext" class="toolbarButton findNext" title="Find the next occurrence of the phrase" tabindex="93" data-l10n-id="find_next">
                <span data-l10n-id="find_next_label">Next</span>
              </button>
            </div>
          </div>

          <div id="findbarOptionsContainer">
            <input type="checkbox" id="findHighlightAll" class="toolbarField" tabindex="94">
            <label for="findHighlightAll" class="toolbarLabel" data-l10n-id="find_highlight">Highlight all</label>
            <input type="checkbox" id="findMatchCase" class="toolbarField" tabindex="95">
            <label for="findMatchCase" class="toolbarLabel" data-l10n-id="find_match_case_label">Match case</label>
            <span id="findResultsCount" class="toolbarLabel hidden"></span>
          </div>

          <div id="findbarMessageContainer">
            <span id="findMsg" class="toolbarLabel"></span>
          </div>
        </div>  <!-- findbar -->

        <div id="secondaryToolbar" class="secondaryToolbar hidden doorHangerRight">
          <div id="secondaryToolbarButtonContainer">
            <button id="secondaryPresentationMode" class="secondaryToolbarButton presentationMode visibleLargeView" title="Switch to Presentation Mode" tabindex="51" data-l10n-id="presentation_mode">
              <span data-l10n-id="presentation_mode_label">Presentation Mode</span>
            </button>

            <button id="secondaryOpenFile" class="secondaryToolbarButton openFile visibleLargeView" title="Open File" tabindex="52" data-l10n-id="open_file">
              <span data-l10n-id="open_file_label">Open</span>
            </button>

            <button id="secondaryPrint" class="secondaryToolbarButton print visibleMediumView" title="Print" tabindex="53" data-l10n-id="print">
              <span data-l10n-id="print_label">Print</span>
            </button>

            <button id="secondaryDownload" class="secondaryToolbarButton download visibleMediumView" title="Download" tabindex="54" data-l10n-id="download">
              <span data-l10n-id="download_label">Download</span>
            </button>

            <a href="#" id="secondaryViewBookmark" class="secondaryToolbarButton bookmark visibleSmallView" title="Current view (copy or open in new window)" tabindex="55" data-l10n-id="bookmark">
              <span data-l10n-id="bookmark_label">Current View</span>
            </a>

            <div class="horizontalToolbarSeparator visibleLargeView"></div>

            <button id="firstPage" class="secondaryToolbarButton firstPage" title="Go to First Page" tabindex="56" data-l10n-id="first_page">
              <span data-l10n-id="first_page_label">Go to First Page</span>
            </button>
            <button id="lastPage" class="secondaryToolbarButton lastPage" title="Go to Last Page" tabindex="57" data-l10n-id="last_page">
              <span data-l10n-id="last_page_label">Go to Last Page</span>
            </button>

            <div class="horizontalToolbarSeparator"></div>

            <button id="pageRotateCw" class="secondaryToolbarButton rotateCw" title="Rotate Clockwise" tabindex="58" data-l10n-id="page_rotate_cw">
              <span data-l10n-id="page_rotate_cw_label">Rotate Clockwise</span>
            </button>
            <button id="pageRotateCcw" class="secondaryToolbarButton rotateCcw" title="Rotate Counterclockwise" tabindex="59" data-l10n-id="page_rotate_ccw">
              <span data-l10n-id="page_rotate_ccw_label">Rotate Counterclockwise</span>
            </button>

            <div class="horizontalToolbarSeparator"></div>

            <button id="cursorSelectTool" class="secondaryToolbarButton selectTool toggled" title="Enable Text Selection Tool" tabindex="60" data-l10n-id="cursor_text_select_tool">
              <span data-l10n-id="cursor_text_select_tool_label">Text Selection Tool</span>
            </button>
            <button id="cursorHandTool" class="secondaryToolbarButton handTool" title="Enable Hand Tool" tabindex="61" data-l10n-id="cursor_hand_tool">
              <span data-l10n-id="cursor_hand_tool_label">Hand Tool</span>
            </button>

            <div class="horizontalToolbarSeparator"></div>

            <button id="documentProperties" class="secondaryToolbarButton documentProperties" title="Document Properties…" tabindex="62" data-l10n-id="document_properties">
              <span data-l10n-id="document_properties_label">Document Properties…</span>
            </button>
          </div>
        </div>  <!-- secondaryToolbar -->

        <div class="toolbar">
          <div id="toolbarContainer">
            <div id="toolbarViewer">
              <div id="toolbarViewerLeft">
                <button id="sidebarToggle" class="toolbarButton" title="Toggle Sidebar" tabindex="11" data-l10n-id="toggle_sidebar">
                  <span data-l10n-id="toggle_sidebar_label">Toggle Sidebar</span>
                </button>
                <div class="toolbarButtonSpacer"></div>
                <button id="viewFind" class="toolbarButton" title="Find in Document" tabindex="12" data-l10n-id="findbar">
                  <span data-l10n-id="findbar_label">Find</span>
                </button>
                <div class="splitToolbarButton hiddenSmallView">
                  <button class="toolbarButton pageUp" title="Previous Page" id="previous" tabindex="13" data-l10n-id="previous">
                    <span data-l10n-id="previous_label">Previous</span>
                  </button>
                  <div class="splitToolbarButtonSeparator"></div>
                  <button class="toolbarButton pageDown" title="Next Page" id="next" tabindex="14" data-l10n-id="next">
                    <span data-l10n-id="next_label">Next</span>
                  </button>
                </div>
                <input type="number" id="pageNumber" class="toolbarField pageNumber" title="Page" value="1" size="4" min="1" tabindex="15" data-l10n-id="page">
                <span id="numPages" class="toolbarLabel"></span>
              </div>
              <div id="toolbarViewerRight">
                <button id="presentationMode" class="toolbarButton presentationMode hiddenLargeView" title="Switch to Presentation Mode" tabindex="31" data-l10n-id="presentation_mode">
                  <span data-l10n-id="presentation_mode_label">Presentation Mode</span>
                </button>

                <button id="openFile" class="toolbarButton openFile hiddenLargeView" title="Open File" tabindex="32" data-l10n-id="open_file">
                  <span data-l10n-id="open_file_label">Open</span>
                </button>

                <button id="print" class="toolbarButton print hiddenMediumView" title="Print" tabindex="33" data-l10n-id="print">
                  <span data-l10n-id="print_label">Print</span>
                </button>

                <button id="download" class="toolbarButton download hiddenMediumView" title="Download" tabindex="34" data-l10n-id="download">
                  <span data-l10n-id="download_label">Download</span>
                </button>
                <a href="#" id="viewBookmark" class="toolbarButton bookmark hiddenSmallView" title="Current view (copy or open in new window)" tabindex="35" data-l10n-id="bookmark">
                  <span data-l10n-id="bookmark_label">Current View</span>
                </a>

                <div class="verticalToolbarSeparator hiddenSmallView"></div>

                <button id="secondaryToolbarToggle" class="toolbarButton" title="Tools" tabindex="36" data-l10n-id="tools">
                  <span data-l10n-id="tools_label">Tools</span>
                </button>
              </div>
              <div id="toolbarViewerMiddle">
                <div class="splitToolbarButton">
                  <button id="zoomOut" class="toolbarButton zoomOut" title="Zoom Out" tabindex="21" data-l10n-id="zoom_out">
                    <span data-l10n-id="zoom_out_label">Zoom Out</span>
                  </button>
                  <div class="splitToolbarButtonSeparator"></div>
                  <button id="zoomIn" class="toolbarButton zoomIn" title="Zoom In" tabindex="22" data-l10n-id="zoom_in">
                    <span data-l10n-id="zoom_in_label">Zoom In</span>
                   </button>
                </div>
                <span id="scaleSelectContainer" class="dropdownToolbarButton">
                  <select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">
                    <option id="pageAutoOption" title="" value="auto" selected="selected" data-l10n-id="page_scale_auto">Automatic Zoom</option>
                    <option id="pageActualOption" title="" value="page-actual" data-l10n-id="page_scale_actual">Actual Size</option>
                    <option id="pageFitOption" title="" value="page-fit" data-l10n-id="page_scale_fit">Page Fit</option>
                    <option id="pageWidthOption" title="" value="page-width" data-l10n-id="page_scale_width">Page Width</option>
                    <option id="customScaleOption" title="" value="custom" disabled="disabled" hidden="true"></option>
                    <option title="" value="0.5" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 50 }'>50%</option>
                    <option title="" value="0.75" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 75 }'>75%</option>
                    <option title="" value="1" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 100 }'>100%</option>
                    <option title="" value="1.25" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 125 }'>125%</option>
                    <option title="" value="1.5" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 150 }'>150%</option>
                    <option title="" value="2" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 200 }'>200%</option>
                    <option title="" value="3" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 300 }'>300%</option>
                    <option title="" value="4" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 400 }'>400%</option>
                  </select>
                </span>
              </div>
            </div>
            <div id="loadingBar">
              <div class="progress">
                <div class="glimmer">
                </div>
              </div>
            </div>
          </div>
        </div>

        <menu type="context" id="viewerContextMenu">
          <menuitem id="contextFirstPage" label="First Page"
                    data-l10n-id="first_page"></menuitem>
          <menuitem id="contextLastPage" label="Last Page"
                    data-l10n-id="last_page"></menuitem>
          <menuitem id="contextPageRotateCw" label="Rotate Clockwise"
                    data-l10n-id="page_rotate_cw"></menuitem>
          <menuitem id="contextPageRotateCcw" label="Rotate Counter-Clockwise"
                    data-l10n-id="page_rotate_ccw"></menuitem>
        </menu>

        <div id="viewerContainer" tabindex="0">
          <div id="viewer" class="pdfViewer"></div>
        </div>

        <div id="errorWrapper" hidden='true'>
          <div id="errorMessageLeft">
            <span id="errorMessage"></span>
            <button id="errorShowMore" data-l10n-id="error_more_info">
              More Information
            </button>
            <button id="errorShowLess" data-l10n-id="error_less_info" hidden='true'>
              Less Information
            </button>
          </div>
          <div id="errorMessageRight">
            <button id="errorClose" data-l10n-id="error_close">
              Close
            </button>
          </div>
          <div class="clearBoth"></div>
          <textarea id="errorMoreInfo" hidden='true' readonly="readonly"></textarea>
        </div>
      </div> <!-- mainContainer -->

      <div id="overlayContainer" class="hidden">
        <div id="passwordOverlay" class="container hidden">
          <div class="dialog">
            <div class="row">
              <p id="passwordText" data-l10n-id="password_label">Enter the password to open this PDF file:</p>
            </div>
            <div class="row">
              <input type="password" id="password" class="toolbarField">
            </div>
            <div class="buttonRow">
              <button id="passwordCancel" class="overlayButton"><span data-l10n-id="password_cancel">Cancel</span></button>
              <button id="passwordSubmit" class="overlayButton"><span data-l10n-id="password_ok">OK</span></button>
            </div>
          </div>
        </div>
        <div id="documentPropertiesOverlay" class="container hidden">
          <div class="dialog">
            <div class="row">
              <span data-l10n-id="document_properties_file_name">File name:</span> <p id="fileNameField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_file_size">File size:</span> <p id="fileSizeField">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span data-l10n-id="document_properties_title">Title:</span> <p id="titleField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_author">Author:</span> <p id="authorField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_subject">Subject:</span> <p id="subjectField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_keywords">Keywords:</span> <p id="keywordsField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_creation_date">Creation Date:</span> <p id="creationDateField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_modification_date">Modification Date:</span> <p id="modificationDateField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_creator">Creator:</span> <p id="creatorField">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span data-l10n-id="document_properties_producer">PDF Producer:</span> <p id="producerField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_version">PDF Version:</span> <p id="versionField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_page_count">Page Count:</span> <p id="pageCountField">-</p>
            </div>
            <div class="buttonRow">
              <button id="documentPropertiesClose" class="overlayButton"><span data-l10n-id="document_properties_close">Close</span></button>
            </div>
          </div>
        </div>
        <div id="printServiceOverlay" class="container hidden">
          <div class="dialog">
            <div class="row">
              <span data-l10n-id="print_progress_message">Preparing document for printing…</span>
            </div>
            <div class="row">
              <progress value="0" max="100"></progress>
              <span data-l10n-id="print_progress_percent" data-l10n-args='{ "progress": 0 }' class="relative-progress">0%</span>
            </div>
            <div class="buttonRow">
              <button id="printCancel" class="overlayButton"><span data-l10n-id="print_progress_close">Cancel</span></button>
            </div>
          </div>
        </div>
      </div>  <!-- overlayContainer -->

    </div> <!-- outerContainer -->
    <div id="printContainer"></div>
  </body>

  <script>
    setInterval(function(){
      var getUrl = window.location;
      var chapter_name = getUrl.pathname.split('/')[2];
      document.title = chapter_name;    
      }, 500);
  </script>

</html>